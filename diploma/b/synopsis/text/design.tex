\section[Проектирование программного модуля]{%
  ПРОЕКТИРОВАНИЕ ПРОГРАММНОГО МОДУЛЯ
}\label{sec:design}

\subsection{Общая характеристика задачи}

В подразделе~\ref{subsec:system_spec_task} было дано простейшее
описание требований к разрабатываемому приложению с точки зрения пользователя.
Целью данного раздела является уточнение требований к мобильному приложению,
разработка его структуры, а также описание различных приемов,
использованных в процессе его проектирования.

Проектирование является неотъемлемой частью жизненного цикла
разработки программного обеспечения.
Существует множество различных методологий проектирования.
Каждая из них предполагает описание требований к разрабатываемой системе
и собственно разработку структуры системы, которая им удовлетворяет.
В ходе проектирования требования к системе многократно дополняются и уточняются.
Характер процесса проектирования определятся используемой
методологией разработки программного обеспечения.
На данный момент существует две основные разновидности методологии разработки ПО:
каскадная и итеративная, представленные на рисунке~\ref{fig:design_methods}.

\begin{figure}[h!]
  \centering
  \fcolorbox{gray}{white}{
    {\small
      \input{fig/design_methods.tex}
    }
  }
  \caption{Методологии разработки программного обеспечения}
  \label{fig:design_methods}
\end{figure}

Каскадная методологии разработки ПО сводится к последовательному
прохождению набора фаз разработки:
анализа требований, проектирования, реализации, тестирования, интеграции и поддержки.
При использовании данной методологии проектирование производится
лишь один раз. Входными данными являются требования к продукту,
а результатом --- набор технических документов, детально описывающих
разрабатываемую систему.
Дальнейшие этапы разработки производятся в строгом соответствии с этими документами;
изменение их содержания на последующих этапах не приветствуется.

Итеративная методология рассматривает процесс разработки ПО как
циклическое прохождение описанных выше фаз разработки.
Это позволяет команде разработчиков более динамично реагировать
как на внутренние, так и на внешние изменения условий и требований.
При использовании данной методологии проектирование производится несколько раз.
На первых порах разрабатывается высокоуровневая архитектура системы,
определяются ключевые требования к ней. Далее, по мере повторения цикла
разработки, производится описание разрабатываемых подсистем и и связей между ними.

Данный проект будет разрабатываться с использованием итеративной методологии:
сначала будет выполнено высокоуровневое описание частей проекта,
а затем по мере реализации уточняются детали функционирования его подсистем.
Проектирование будет выполняться с использованием языка графического
моделирования UML~\cite{fowler04}, а также набора документированных решений,
известных как паттерны проектирования GoF~\cite{gamma01}.

Объектом проектирования является мобильное приложение,
которое представляет собой самостоятельный программный модуль.
Поскольку необходимость интеграции в какую-либо существующую
систему отсутствует, задача проектирования значительно упрощается.
С другой стороны, целевая мобильная платформа выдвигает ряд дополнительных
требований к объекту проектирования:
\begin{itemize}
\item более строгие ограничения на используемые ресурсы;
\item учет разнообразия конфигураций мобильных устройств;
\item поддержка совместимости между различными версиями
  мобильной платформы.
\end{itemize}

Мобильные устройства располагают, как правило, меньшими вычислительными
ресурсами по сравнению с ПК. Кроме этого, при разработке приложения для
мобильной платформы требуется учитывать его влияние на энергопотребление.
Размер и плотность дисплеев мобильных устройств изменяется в широких пределах,
что влияет на качество отображения информации, предоставляемой приложением.
Программные интерфейсы различных версий мобильной платформы
могут быть несовместимы между собой.

Объектом проектирования является мобильное приложение,
выполняющее учет финансовых данных. По большому счету, пользователь
ожидает от него выполнения двух основных функций:
ввода финансовых данных и представления статистики на основе этих данных,
как показано на рисунке~\ref{fig:design_use_cases}.

\begin{figure}[h!]
  \centering
  \fcolorbox{gray}{white}{\input{fig/design_use_cases.tex}}
  \caption{Диаграмма прецендентов \\ использования приложения}
  \label{fig:design_use_cases}
\end{figure}

В нашем случае основную важность приобретает не столько богатство
функциональности приложения, сколько удобство его повседневного использования.
В связи с этим на первый план выходят такие требования, как
высокая скорость ввода данных и наглядность их представления.
Скорость ввода данных достигается, в первую очередь, за счет
продуманного интерфейса приложения ---
ввод данных должен требовать заполнения минимально числа полей;
интерфейс ввода должен быть предельно простым.
Наглядность представления данных достигается за счет надлежащей
структуризации данных и использования графических средств их представления.
Поскольку приложение выполняет хранение данных, возникает необходимость
разработки модели данных и использовании соответствующей базы данных.
Кроме этого, для реализации функции ввода данных с изображения
требуется разработать соответствующую подсистему.

\subsection{Структура разрабатываемого модуля}

Фундаметнальной проблемой, возникающей при разработке программного обеспечения,
является проблема управления сложностью. Зачастую моделируемые объекты реального
мира и механизмы их взаимодействия являются чересчур сложными для восприятия человека.
Дополнительную сложность вносят детали программной
реализации, которые радикально отличаются от сущности объекта моделирования.

Основным методологией управления сложностью при разработке программного обеспечения
на данным момент можно считать объектно-ориентированный подход.
Этот подход вводит ключевое понятие объекта как базового элемента
архитектуры системы на этапе проектирования.
Сущность подхода раскрывается через такие понятия абстракции, инкапсуляции,
наследования и полиморфизма.
Модели, полученные с использованием данного подхода, весьма точно
описывают предметную область и являются простыми для понимания.

В ходе многолетней практики использования объектно-ориентированного подхода
для разработки сложных систем были разработаны так называемые паттерны проектирования.
Эти паттерны представляют собой гибкие, удобные для понимания и
готовые для применения механизмы создания, структуризации и взаимодействия объектов.

Следующий уровень абстракции занимают библиотеки.
Библиотеки представляют собой наборы специализированных структур данных и
связанных с ними алгоритмов для решения задач в заданной предметной области.

На верхнем уровне абстракции находятся фреймворки.
Они являются каркасами будущих систем и подсистем приложения, определяя его структуру.

Разработка приложения для платформы Android предполагает использование
объектно-ориентированного подхода. Несмотря на то, что в общем случае
платформа не предписывает использование какого-либо фреймворка,
ее программный интерфейс накладывает существенные ограничения на
архитектуру приложения.

Поскольку разрабатываемое приложение имеет графический интерфейс,
имеет смысл выполнять его проектирование на базе одного из известных паттернов
разработки приложений с графическим интерфейсом. Примером подобного паттерна
является MVP --- model-view-presenter, представленный на
рисунке~\ref{fig:design_mvp}.

\begin{figure}[h!]
  \centering
  \fcolorbox{gray}{white}{\input{fig/design_mvp.tex}}
  \caption{Паттерн проектирования MVP}
  \label{fig:design_mvp}
\end{figure}

Основной идеей данного паттерна является разделение объектов приложения на три типа.
Объекты типа Model представляют собой ресурсы приложения, как они организуют доступ
к базе данных. Объекты типа View занимаются представлением данных. Они определяют,
в каком виде данные будут показываться пользователю. Взаимодействие этих объектов
производится через объекты типа Presenter, определяющих логику обработки
обработки данных (бизнес-логику). В этом заключается основное отличие данного паттерна от
его предшественника MVC.

На рисунке~\ref{fig:design_main} представлена структура проектируемого приложения,
выполненная на базе паттерна MVP.
Здесь Model соответствуют подсистемы хранения данных и компьютерного зрения;
Presenter --- бизнес-логики, а View --- графического интерфейса.
Как и предписывается паттерном MVP, подсистемы графического интерфейса,
базы данных и компьютерного зрения изолированы друг от друга и взаимодействуют
через слой бизнес-логики.

\begin{figure}[h!]
  \centering
  \fcolorbox{gray}{white}{\input{fig/design_main.tex}}
  \caption{Структура приложения}
  \label{fig:design_main}
\end{figure}

Отдельно остановимся на подсистеме компьютерного зрения.
Данная подсистема предоставляет программный интерфейс оптического распознавания
символов (OCR) и носит экспериментальный характер.

\subsection{Информационное обеспечение}

Описание информационного обеспечения программного продукта сводится
к описанию формата входных и выходных данных, а также модели хранения
этих данных в СУБД.

Разрабатываемое приложение имеет достаточно простой набор сущностей
предметной области: <<изменение баланса>>, <<учетная запись>>, <<категория>>.
Рассмотрим эти сущности более подробно.
Сущность <<изменение баланса>> используется для регистрации изменений
финансового состояния пользователя и соответствует единичной транзакции
денежных средств.
Примерами подобной сущности является получение заработной платы,
расход денежных средств на замену автомобильной резины или поход в
парикмахерскую.
Сущность <<учетная запись>> соответствует средству хранения денежных
средств, например, банковской карте или наличным.
Данная сущность определяет валюту, в которой производится учет изменений
баланса.
Сущность <<категория>> используется для группировки изменений баланса
по статьям доходов или расходов. Примерами экземпляров данной сущности
могут являться <<заработная плата>>, <<продукты>>, <<транспорт>>,~и~т.~д.
На рисунке~\ref{fig:design_entities} представлена модель данных
разрабатываемого приложения.

\begin{figure}[h!]
  \centering
  \fcolorbox{gray}{white}{
    \includegraphics[width=140mm]{fig/design_entities.eps}
  }
  \caption{Модель данных приложения}
  \label{fig:design_entities}
\end{figure}

В соответствии с ней, сущность <<УчетнаяЗапись>> имеет поле названия,
являющееся ключевым, поле кода валюты, соответсвующее коду валюты по
стандарту ISO 4217, а также ссылку на множество сущностей
<<ИзменениеБаланса>>. Данные сущности имеют служебное поле <<Индекс>>,
являющееся ключевым, поле даты регистрации, величины изменения баланса,
а также ссылку на множество связанных категорий.
Сущность <<Категория>> имеет ключевое поле названия, а также поле типа,
определяющее, относится ли данная категория к доходам или расходам.

Определенный интерес представляет вопрос выбора типа данных для хранения
значения изменения баланса. Дело в том, что для хранения финансовых данных
использовать дробные типы данных не рекомендуется
из-за ошибок округления~\cite{bloch08}. С другой стороны, не все СУБД
поддерживают специализированный тип данных для работы с валютой.
В связи с этим было решено использовать целочисленное
поле двойной длины (long), младшие девять разрядов которого используются
для хранения дробной части, а старшие --- для хранения целой части
исходной величины.

Ввод данных в приложение носит преимущественно ручной характер:
например, при вводе данных об ихменении баланса
пользователь приложения должен ввести величину изменения баланса,
выбрать желаемые категории и указать дату.
Использование экспериментальной подсистемы OCR позволяет производить
ввод данных о величине изменения баланса в полуавтоматическом режиме.
Вывод данных производится в текстовом и графическом виде и
представляет как собственно хранимые данные, так и данные, полученные путем
применения агрегатных функций. Например, практический интерес представляют
суммы изменений баланса за указанный период, а также распределение
данных сумм по различным категориям учета.

% \subsection{Математическое обеспечение}

% Этапы процесса распознавания образов.
% Краткое математическое описание алгоримов, используемых на каждом этапе.
% Достоинства/недостатки/мотивация выбора.

% \subsection{Алгоритмическое обеспечение}

% % Проектирование алгоритма распознавания изображений.
% % Блок-схема окончательного алгоритма распознавания.

% \subsection{Системные требования}

% Требования к техническому и системному программному обеспечению.
% Android >= 4.0.x.

% \subsection{Эргономическое обеспечение}

% Проектирование пользовательского интерфейса (Material design).
% Схема переходов между экранами. Экраны приложения.