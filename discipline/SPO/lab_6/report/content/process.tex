\section{ХОД РАБОТЫ}

\subsection{Текст задания}

Для всех вариантов необходимо выполнить следующее:

\begin{itemize}
\item
  функции, определенные в работах 4 и 5, оформить в виде библиотеки DLL;
\item
  создать новый проект для демонстрации работы с DLL и функциями;
\item
  в нечетных номерах заданий необходимо использовать
  статическое связывание с импортом; 
\item
  создать специальный заголовочный файл с объявлениями функций,
  подлежащих импорту.
\end{itemize}

\subsection{Исходные данные}

На рисунке~\ref{lst:struct_and_functions} представлена структура Complex
и ряд функций по работе с комплексными числами,
реализованных в предыдущих лабораторных работах.

\begin{lstlisting}[caption=Структура Complex
  и прототипы функций для работы с ней,
  label=lst:struct_and_functions]
 struct Complex {
   double re;
   double im;
 };
 
 struct Complex add(struct Complex c1, struct Complex c2);
 struct Complex sub(struct Complex c1, struct Complex c2);
 struct Complex mul(struct Complex c1, struct Complex c2);
 struct Complex div(struct Complex c1, struct Complex c2);
 
 void print_complex(struct Complex c);
 
 void
 writeComplex(char *fname, struct Complex *complex, int count);

 int
 readComplex(char *fname, struct Complex *complex, int count);
\end{lstlisting}

\subsection{Создание и использование динамических библиотек
  в среде \\ разработки Microsoft Visual Studio}

В этом подразделе приведено пошаговое описание действий для создания и использования
динамических библиотек в среде разработки Microsoft Visual Studio.

\paragraph{}
Создание проекта библиотеки динамической компоновки (DLL) выполняется следующим образом:
\begin{enumerate}
\item
  В меню <<Файл>> выбрать пункты <<Создать>>, <<Проект>>.
\item
  В левой области в категории <<Visual C++>> выбрать <<Win32>>.
\item
  В центральной области выбрать <<Консольное приложение Win32>>.
\item
  Указать имя для проекта --- например, MathFuncsDll --- в поле <<Имя>>.
  Указать имя для решения --- например, DynamicLibrary --- в поле <<Имя решения>>.
  Нажмите кнопку <<ОК>>.
\item
  На странице <<Обзор>> диалогового окна <<Мастер приложений Win32>> нажать кнопку <<Далее>>.
\item
  На странице <<Параметры приложения>> в разделе <<Тип приложения>> выбрать <<DLL>>.
\item
  Нажать кнопку <<Готово>>, чтобы создать проект.
\end{enumerate}

\paragraph{}
Создание консольного проекта, ссылающегося на DLL в среде
Microsoft Visual Studio выполняется следующим образом:

\begin{enumerate}
\item
  В левой области в категории <<Visual C++>> выбрать <<Win32>>.
\item
  В центральной области выбрать <<Консольное приложение Win32>>.
\item
  Указать имя проекта --- например, MyExecRefsDll --- в поле <<Имя>>.
  В раскрывающемся списке рядом с полем <<Решение>> выбрать <<Добавить в решение>>.
  В результате новый проект будет добавлен в решение, содержащее статическую библиотеку.
  Нажать кнопку <<ОК>>.
\item
  На странице <<Обзор диалогового окна Мастер приложений Win32>> нажать кнопку <<Далее>>.
\item
  На странице <<Параметры приложения>> выбрать в поле <<Тип приложения>> пункт
  <<Консольное приложение>>.
\item
  На странице <<Параметры приложения>> в разделе <<Дополнительные параметры>>
  снять флажок <<Предкомпилированный заголовок>>.
\item
  Нажать кнопку <<Готово>>, чтобы создать проект.
\end{enumerate}

Для того, чтобы использовать функциональность статической библиотеки в проекте
Microsoft Visual Studio, следует выполнить следующие операции:

\begin{enumerate}
\item
  Открыть контекстное меню проекта MyExecRefsLib в области
  <<Обозреватель решений>> и выбрать <<Ссылки>>.
\item
  В диалоговом окне <<Страницы свойств MyExecRefsLib>> развернуть узел <<Общие свойства>>,
  выбрать <<.NET Framework и ссылки>> и нажать кнопку <<Добавить новую ссылку>>.
\item
  Установить флажок рядом с MathFuncsLib на вкладке <<Проекты>>,
  а затем нажать кнопку <<ОК>>.
\item
  Для создания ссылки на файл заголовка MathFuncsLib.h необходимо изменить путь
  к каталогам включения.
  Для этого в диалоговом окне Окна свойств библиотеки MyExecRefsLib последовательно
  развернуть узлы <<Свойства конфигурации>>, <<C/C++>>, затем выбрать <<Общие>>.
  В поле <<Дополнительные каталоги включаемых файлов>> указать путь к каталогу
  MathFuncsLib.
\item
  Нажать кнопку <<ОК>> для сохранения изменений в проект.
\end{enumerate}

\pagebreak 

\subsection{Особенности разработанной программы}
\label{ssec:program_description}

В ходе проведения данной лабораторной работы была проведена реорганизация 
исходных файлов проекта, преследующая следующие цели:

\begin{itemize}
\item уменьшение числа зависимостей в файлах с исходным кодом;
\item выделение кода функций, выполняющих обработку структуры Complex, 
  в отдельные библиотеки.
\end{itemize}

Схема зависимостей исходных файлов проекта показана на рисунке~\ref{fig:dependencies}.

\begin{figure}[htbp]
  \centering
  \small{
    \input{img/dependencies}
  }
  \caption{Схема зависимостей исходных файлов проекта}\label{fig:dependencies}
\end{figure}

Файлы, помеченные синим цветом, компилируются в статические библиотеки,
так как они имеют зависимости только от одного файла с описаниями функций.
Каждый из этих файлов содержит определения логически-независимых операций со 
структурой Complex:

\begin{itemize}
  \item complex.c содержит функции арифметических операций над структурой типа Complex;
  \item io.c содержит вспомогательные функции для работы с консолью.
\end{itemize} 

Остальные файлы исходного кода программы имеют следующие назначения:
\begin{itemize}
  \item main.c содержит функцию main(), используемую для запуска программы;
  \item interface.c содержит функции для взаимодействия с пользователем через
    консольный интерфейс;
  \item file\_io.c содержит функции для чтения и записи Complex в файл;
  \item complex\_io.c содержит функции для ввода содержимого структуры Complex
    через консольный интерфейс.
\end{itemize}

После реорганизации исходного кода проекта была выполнена компиляция приложения.

Главное меню скомпилированного приложения показано на рисунке~\ref{fig:main_menu}.

\begin{figure}[htbp]
  \centering
  \includegraphics[width=150mm,height=80mm]{img/main_menu}
  \caption{Главное меню программы}\label{fig:main_menu}
\end{figure}

Исходный текст разработанной программы расположен в приложении~А.

\newpage